<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YScript Rules Engine - Example Usage</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
    }
    h2 {
      color: #34495e;
      margin-top: 30px;
    }
    .sample-document {
      background: #ecf0f1;
      padding: 15px;
      border-left: 4px solid #3498db;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
    }
    .result {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin: 20px 0;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    .error {
      background: #ffebee;
      border-left: 4px solid #f44336;
      padding: 15px;
      margin: 20px 0;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #2980b9;
    }
    .controls {
      margin: 20px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 4px;
    }
    textarea {
      width: 100%;
      min-height: 200px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
    }
    .compliant {
      color: #4caf50;
      font-weight: bold;
    }
    .non-compliant {
      color: #f44336;
      font-weight: bold;
    }
    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¯ YScript Rules-as-Code Engine</h1>
    <p><strong>Sophisticated backend preprocessing system for Victorian statutory compliance</strong></p>

    <div class="info-box">
      <strong>Features:</strong>
      <ul>
        <li>âœ“ Parses statutes into machine-executable rules</li>
        <li>âœ“ Evaluates documents against rule conditions programmatically</li>
        <li>âœ“ Supports logical operators: AND, OR, NOT, IF-THEN</li>
        <li>âœ“ Extracts evidence with confidence scoring</li>
        <li>âœ“ Returns structured compliance results with remedies</li>
      </ul>
    </div>

    <h2>Sample Documents</h2>

    <div class="controls">
      <h3>Compliant Document (Good Police Work)</h3>
      <div class="sample-document" id="compliant-doc">On 15 January 2024 at 11:45pm, I was on patrol on High Street, Melbourne when I observed a white Toyota Camry registration ABC123 being driven erratically, swerving across lanes.

I intercepted the vehicle and spoke with the driver, John Smith. I immediately detected a strong smell of alcohol on his breath. His eyes were bloodshot and he was unsteady on his feet.

I formed the belief that Mr Smith had consumed alcohol and had been driving a motor vehicle. I therefore had reason to believe that he had alcohol in his body and had driven a motor vehicle.

Based on these observations, I required Mr Smith to undergo a preliminary breath test pursuant to section 49(1) of the Road Safety Act 1986. The preliminary breath test returned a positive result.

I then required Mr Smith to accompany me to the police station for an evidentiary breath test. The test was conducted using an approved breath testing instrument by a qualified operator in accordance with approved procedures.

I informed Mr Smith of his right to have a sample taken by a medical practitioner. The evidentiary breath test showed a blood alcohol reading of 0.12%.</div>
      <button onclick="analyzeCompliantDoc()">Analyze Compliant Document</button>
    </div>

    <div class="controls">
      <h3>Non-Compliant Document (Defective Procedure)</h3>
      <div class="sample-document" id="non-compliant-doc">On 15 January 2024 at 11:45pm, I was on patrol on High Street, Melbourne.

I saw John Smith driving and I decided to pull him over. I asked him to do a breath test. The test came back positive for alcohol.

I took him to the station for another breath test. The reading was 0.12%.

Mr Smith was charged with driving with excess blood alcohol.</div>
      <button onclick="analyzeNonCompliantDoc()">Analyze Non-Compliant Document</button>
    </div>

    <div class="controls">
      <h3>Custom Document Analysis</h3>
      <textarea id="custom-doc" placeholder="Paste your document text here for analysis..."></textarea>
      <div>
        <button onclick="analyzeCustomDoc()">Analyze Custom Document</button>
        <button onclick="findDefects()">Find Defects Only</button>
        <button onclick="generateForensicReport()">Generate Full Forensic Report</button>
      </div>
    </div>

    <h2>Analysis Results</h2>
    <div id="results" class="result">Results will appear here...</div>

    <h2>Quick Tests</h2>
    <div class="controls">
      <button onclick="demonstrateLogicalOperators()">Test Logical Operators</button>
      <button onclick="demonstrateEvidenceExtraction()">Test Evidence Extraction</button>
      <button onclick="showEngineStatistics()">Show Engine Statistics</button>
      <button onclick="exportRules()">Export All Rules</button>
    </div>
  </div>

  <script type="module">
    import { createAnalyzer, PresetAnalyzers } from './YScriptIntegration.js';

    // Create global analyzer instance
    window.analyzer = createAnalyzer({ debug: true });

    console.log('âœ“ YScript Engine initialized');
    console.log('âœ“ Loaded rules:', window.analyzer.getStatistics());

    // Make functions available globally
    window.analyzeCompliantDoc = function() {
      const doc = document.getElementById('compliant-doc').textContent;
      const results = window.analyzer.analyzeRoadSafetyCompliance(doc);
      displayResults(results);
    };

    window.analyzeNonCompliantDoc = function() {
      const doc = document.getElementById('non-compliant-doc').textContent;
      const results = window.analyzer.analyzeRoadSafetyCompliance(doc);
      displayResults(results);
    };

    window.analyzeCustomDoc = function() {
      const doc = document.getElementById('custom-doc').value;
      if (!doc.trim()) {
        alert('Please enter document text first');
        return;
      }
      const results = window.analyzer.analyzeRoadSafetyCompliance(doc);
      displayResults(results);
    };

    window.findDefects = function() {
      const doc = document.getElementById('custom-doc').value;
      if (!doc.trim()) {
        alert('Please enter document text first');
        return;
      }
      const defects = window.analyzer.findDefects(doc);
      displayResults(defects);
    };

    window.generateForensicReport = function() {
      const doc = document.getElementById('custom-doc').value;
      if (!doc.trim()) {
        alert('Please enter document text first');
        return;
      }
      const report = window.analyzer.generateForensicReport(doc, {
        focusStatute: 'Road Safety Act',
        includeEvidence: true
      });
      displayResults(report);
    };

    window.demonstrateLogicalOperators = function() {
      const testDoc = `The officer had reason to believe that the person had consumed alcohol
and had driven a motor vehicle. The officer observed that the person had bloodshot eyes
and was unsteady on their feet.`;

      const results = window.analyzer.engine.evaluateRule(
        'RSA_s49_1_reason_to_believe',
        testDoc
      );

      displayResults({
        title: 'Logical Operator Demonstration (AND operator)',
        description: 'This rule requires ALL conditions to be satisfied',
        results: results
      });
    };

    window.demonstrateEvidenceExtraction = function() {
      const testDoc = `I formed the belief that the driver had consumed alcohol.
I detected a strong smell of alcohol on his breath. His eyes were bloodshot and glassy.
He was unsteady on his feet and his speech was slurred.`;

      const results = window.analyzer.engine.evaluateRule(
        'RSA_s49_1_articulation_of_belief',
        testDoc
      );

      displayResults({
        title: 'Evidence Extraction Demonstration',
        description: 'Shows how the engine finds and extracts evidence with confidence scores',
        results: results
      });
    };

    window.showEngineStatistics = function() {
      const stats = window.analyzer.getStatistics();
      displayResults({
        title: 'Engine Statistics',
        statistics: stats
      });
    };

    window.exportRules = function() {
      const rulesJSON = window.analyzer.engine.exportRules();
      displayResults({
        title: 'Exported Rules (JSON)',
        rules: JSON.parse(rulesJSON)
      });
    };

    function displayResults(results) {
      const resultsDiv = document.getElementById('results');

      // Format results nicely
      let output = '';

      if (results.report) {
        output = results.report;
      } else if (results.formattedReport) {
        output = results.formattedReport;
      } else {
        output = JSON.stringify(results, null, 2);
      }

      resultsDiv.textContent = output;

      // Color code compliance status
      if (output.includes('âœ“ COMPLIANT')) {
        resultsDiv.style.background = '#e8f5e9';
        resultsDiv.style.borderLeftColor = '#4caf50';
      } else if (output.includes('âœ— NON-COMPLIANT')) {
        resultsDiv.style.background = '#ffebee';
        resultsDiv.style.borderLeftColor = '#f44336';
      } else {
        resultsDiv.style.background = '#e3f2fd';
        resultsDiv.style.borderLeftColor = '#2196f3';
      }

      // Scroll to results
      resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Display welcome message
    displayResults({
      message: 'YScript Rules Engine Ready',
      info: 'Click any button above to test the engine',
      stats: window.analyzer.getStatistics()
    });
  </script>
</body>
</html>
